# 99 Taberna Noctis 文档网站 - 服务器部署指南

## 97 目录

- [部署准备](#部署准备)
- [方案一：使用云服务器](#方案一使用云服务器)
- [方案二：使用 GitHub Pages（免费）](#方案二使用github-pages免费)
- [方案三：使用 Vercel/Netlify（免费）](#方案三使用vercelnetlify免费)
- [方案四：内网服务器](#方案四内网服务器)
- [故障排除](#故障排除)

---

## 部署准备

### 73 Web 文件夹包含的文件

确保 `Web` 文件夹中包含以下文件：

```
Web/
├── index.html                          # 主页面
├── Documents.md                        # 游戏概述
├── CardSystem_Parameters.md            # 卡牌系统参数
├── DailyEvents_ZH_EN.md               # 每日事件
├── DailyMessageSystem_DevDoc.md       # 每日信息系统
├── QueueSystem_DevDoc.md              # 队列系统
├── RandomSystem_DevDoc.md             # 随机系统
├── SaveSystem_DevDoc.md               # 存档系统
├── SceneManager_DevDoc.md             # 场景管理器
└── TimeSystem_DevDoc.md               # 时间系统
```

### 7215 重要提示

- 所有文件必须使用 **UTF-8 编码**
- 确保文件名大小写正确（Linux 服务器区分大小写）
- 检查文档中的图片路径是否正确

---

## 方案一：使用云服务器

适合需要完全控制和自定义的场景。

### 1. 选择云服务器提供商

推荐：

- **阿里云** (aliyun.com)
- **腾讯云** (cloud.tencent.com)
- **AWS** (aws.amazon.com)
- **DigitalOcean** (digitalocean.com)

### 2. 购买服务器

- **配置要求**：最低配置即可（1 核 CPU，1GB 内存）
- **操作系统**：Ubuntu 20.04 LTS 或 CentOS 7+
- **带宽**：1Mbps 足够小团队使用

### 3. 部署步骤（以 Ubuntu 为例）

#### 3.1 连接到服务器

```bash
ssh root@your-server-ip
```

#### 3.2 安装 Nginx（推荐）

```bash
# 更新包管理器
sudo apt update

# 安装 Nginx
sudo apt install nginx -y

# 启动 Nginx
sudo systemctl start nginx
sudo systemctl enable nginx
```

#### 3.3 上传文件

使用 FTP/SFTP 工具（如 FileZilla）或命令行：

```bash
# 在本地电脑上执行（PowerShell或CMD）
scp -r "D:\Unity Projection\Taberna-Noctis\Assets\Documents\Web\*" root@your-server-ip:/var/www/html/docs/
```

#### 3.4 配置 Nginx

编辑 Nginx 配置：

```bash
sudo nano /etc/nginx/sites-available/docs
```

添加以下内容：

```nginx
server {
    listen 80;
    server_name your-domain.com;  # 或使用服务器IP

    root /var/www/html/docs;
    index index.html;

    # 启用 gzip 压缩
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml text/javascript;

    location / {
        try_files $uri $uri/ /index.html;
    }

    # 缓存静态资源
    location ~* \.(jpg|jpeg|png|gif|ico|css|js|svg)$ {
        expires 7d;
        add_header Cache-Control "public, immutable";
    }

    # 允许跨域（如果需要）
    add_header Access-Control-Allow-Origin *;
}
```

启用配置并重启：

```bash
sudo ln -s /etc/nginx/sites-available/docs /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

#### 3.5 配置 HTTPS（推荐，使用 Let's Encrypt）

```bash
# 安装 Certbot
sudo apt install certbot python3-certbot-nginx -y

# 获取 SSL 证书
sudo certbot --nginx -d your-domain.com

# 自动续期
sudo certbot renew --dry-run
```

#### 3.6 访问网站

现在可以通过以下方式访问：

- `http://your-server-ip/`
- `https://your-domain.com/`（如果配置了域名和 SSL）

---

## 方案二：使用 GitHub Pages（免费）

最简单的免费托管方案，适合公开文档。

### 1. 创建 GitHub 仓库

1. 访问 [GitHub](https://github.com)
2. 点击 "New Repository"
3. 仓库名称：`taberna-noctis-docs`
4. 设置为 Public（必须）
5. 点击 "Create repository"

### 2. 上传文件

#### 方法 A：使用 Git 命令行

```bash
# 在 Web 文件夹中执行
cd "D:\Unity Projection\Taberna-Noctis\Assets\Documents\Web"

# 初始化 Git 仓库
git init

# 添加所有文件
git add .

# 提交
git commit -m "Initial commit: Taberna Noctis Documentation"

# 添加远程仓库
git remote add origin https://github.com/your-username/taberna-noctis-docs.git

# 推送
git branch -M main
git push -u origin main
```

#### 方法 B：使用 GitHub 网页上传

1. 在仓库页面点击 "uploading an existing file"
2. 拖拽 Web 文件夹中的所有文件
3. 点击 "Commit changes"

### 3. 启用 GitHub Pages

1. 进入仓库 Settings
2. 左侧找到 "Pages"
3. Source 选择 "main" 分支
4. 文件夹选择 "/ (root)"
5. 点击 "Save"

### 4. 访问网站

几分钟后，你的网站将在以下地址可用：

```
https://your-username.github.io/taberna-noctis-docs/
```

### 5. 绑定自定义域名（可选）

1. 在 GitHub Pages 设置中添加 Custom domain
2. 在域名提供商处添加 CNAME 记录指向 `your-username.github.io`

---

## 方案三：使用 Vercel/Netlify（免费）

最快速的部署方案，自动 HTTPS 和 CDN。

### 使用 Vercel

#### 1. 注册 Vercel

访问 [vercel.com](https://vercel.com) 并注册账号

#### 2. 安装 Vercel CLI

```bash
npm install -g vercel
```

#### 3. 部署

```bash
# 进入 Web 文件夹
cd "D:\Unity Projection\Taberna-Noctis\Assets\Documents\Web"

# 登录
vercel login

# 部署
vercel

# 按照提示操作
# - Setup and deploy? Yes
# - Which scope? 选择你的账号
# - Link to existing project? No
# - Project name? taberna-noctis-docs
# - Directory? ./
```

#### 4. 访问网站

部署完成后会获得一个 URL：

```
https://taberna-noctis-docs.vercel.app
```

### 使用 Netlify

#### 方法 A：拖拽上传（最简单）

1. 访问 [netlify.com](https://netlify.com)
2. 注册并登录
3. 将整个 `Web` 文件夹拖拽到 Netlify 的上传区域
4. 几秒钟后网站就部署好了！

#### 方法 B：使用 CLI

```bash
# 安装 Netlify CLI
npm install -g netlify-cli

# 进入 Web 文件夹
cd "D:\Unity Projection\Taberna-Noctis\Assets\Documents\Web"

# 登录
netlify login

# 部署
netlify deploy --prod
```

---

## 方案四：内网服务器

适合只在公司/团队内部访问的场景。

### 1. 使用现有的内网服务器

#### 在 Windows Server 上

1. 安装 IIS（Internet Information Services）
2. 将 `Web` 文件夹复制到 `C:\inetpub\wwwroot\docs\`
3. 在 IIS 管理器中创建新的网站
4. 绑定端口（如 80 或 8080）
5. 启动网站

访问地址：`http://内网IP:端口/`

#### 在 Linux 服务器上

参考"方案一"中的 Nginx 配置，但不需要购买云服务器。

### 2. 使用简单的 Python/Node.js 服务器

```bash
# Python 方式
cd "D:\Unity Projection\Taberna-Noctis\Assets\Documents\Web"
python -m http.server 8080

# Node.js 方式
npx http-server -p 8080
```

然后告诉团队成员访问：`http://你的电脑IP:8080/`

---

## 配置防火墙

### 云服务器

在云服务器控制台的"安全组"中开放端口：

- HTTP: 80
- HTTPS: 443

### 本地/内网服务器

#### Windows 防火墙

```powershell
# 允许入站连接（以管理员身份运行）
New-NetFirewallRule -DisplayName "Allow HTTP" -Direction Inbound -LocalPort 80 -Protocol TCP -Action Allow
New-NetFirewallRule -DisplayName "Allow HTTPS" -Direction Inbound -LocalPort 443 -Protocol TCP -Action Allow
```

#### Linux 防火墙（UFW）

```bash
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw reload
```

---

## 性能优化建议

### 1. 启用 Gzip 压缩

Nginx 配置已包含，Vercel/Netlify 自动启用。

### 2. 使用 CDN

- **Cloudflare**（免费）：配置简单，提供全球 CDN
- 注册 Cloudflare → 添加网站 → 按照指引修改 DNS

### 3. 图片优化

如果文档中有图片：

```bash
# 使用工具压缩图片
npm install -g imagemin-cli
imagemin media/*.png --out-dir=media/optimized
```

---

## 更新文档

### GitHub Pages/Vercel/Netlify

只需更新仓库内容，会自动重新部署：

```bash
cd "D:\Unity Projection\Taberna-Noctis\Assets\Documents\Web"
git add .
git commit -m "Update documentation"
git push
```

### 云服务器/内网服务器

使用 SFTP 上传更新后的文件，或使用 rsync：

```bash
rsync -avz --delete "D:\Unity Projection\Taberna-Noctis\Assets\Documents\Web\*" root@your-server-ip:/var/www/html/docs/
```

---

## 故障排除

### 问题 1：文档内容不显示

**原因**：CORS 跨域问题或文件路径错误

**解决方案**：

1. 确保所有 `.md` 文件都在与 `index.html` 同一目录
2. 检查 Nginx 配置中的 CORS 头部设置
3. 在浏览器开发者工具 Console 查看错误信息

### 问题 2：中文乱码

**原因**：文件编码问题

**解决方案**：

```bash
# 确保所有文件使用 UTF-8 编码
# 在 VS Code 中：右下角点击编码 → "Save with Encoding" → "UTF-8"
```

### 问题 3：Mermaid 图表不显示

**原因**：CDN 加载失败或网络问题

**解决方案**：

1. 检查网络连接
2. 考虑下载 Mermaid.js 到本地而不使用 CDN
3. 在控制台查看是否有加载错误

### 问题 4：无法访问服务器

**原因**：防火墙或端口未开放

**解决方案**：

1. 检查云服务器安全组设置
2. 确认 Nginx 正在运行：`sudo systemctl status nginx`
3. 测试端口：`telnet server-ip 80`

---

## 监控和日志

### Nginx 访问日志

```bash
# 查看访问日志
sudo tail -f /var/log/nginx/access.log

# 查看错误日志
sudo tail -f /var/log/nginx/error.log
```

### 简单的访问统计

```bash
# 统计访问次数
awk '{print $1}' /var/log/nginx/access.log | sort | uniq -c | sort -rn | head -10
```

---

## 安全建议

1. **启用 HTTPS**：使用 Let's Encrypt 免费证书
2. **定期更新**：保持服务器软件最新
3. **限制访问**（如果是内部文档）：
   - 使用 Basic Auth
   - 配置 IP 白名单
   - 使用 VPN

### Nginx Basic Auth 示例

```bash
# 安装工具
sudo apt install apache2-utils

# 创建密码文件
sudo htpasswd -c /etc/nginx/.htpasswd username

# 在 Nginx 配置中添加
auth_basic "Restricted Access";
auth_basic_user_file /etc/nginx/.htpasswd;
```

---

## 推荐方案总结

| 场景           | 推荐方案              | 优点                  | 成本    |
| -------------- | --------------------- | --------------------- | ------- |
| **公开文档**   | GitHub Pages / Vercel | 免费、自动部署、HTTPS | 免费    |
| **小团队内部** | Netlify 拖拽上传      | 最简单、快速          | 免费    |
| **企业级需求** | 云服务器 + Nginx      | 完全控制、可定制      | ~0650/月 |
| **临时演示**   | Python HTTP Server    | 无需配置              | 免费    |

---

## 快速决策树

```
需要公开访问？
├─ 是 → 预算如何？
│  ├─ 无预算 → GitHub Pages / Vercel
│  └─ 有预算 → 云服务器（更灵活）
└─ 否（仅内部）→ 团队规模？
   ├─ 小型（<10人）→ 简单 Python 服务器
   └─ 中大型 → 内网服务器 + Nginx
```

---

## 联系支持

如有问题，请查看：

- Nginx 文档：https://nginx.org/en/docs/
- GitHub Pages 文档：https://pages.github.com/
- Vercel 文档：https://vercel.com/docs
- Netlify 文档：https://docs.netlify.com/

---

**祝部署顺利！** 04
